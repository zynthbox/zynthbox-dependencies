#!/usr/bin/make -f
# See debhelper(7) (uncomment to enable)
# output every command that modifies files on the build system.
#export DH_VERBOSE = 1
DEB_HOST_ARCH = $(shell dpkg-architecture -qDEB_HOST_ARCH)

FLAGS  = -O3 -ffast-math -fPIC -DPIC -fvisibility=hidden -fdata-sections -ffunction-sections -DNDEBUG
ifeq ($(DEB_HOST_ARCH),armhf)
FLAGS += -march=armv7ve -mcpu=cortex-a7 -mfloat-abi=hard -mfpu=neon-vfpv4 -mno-unaligned-access
CMAKE_EXTRA_OPTS = -DLINUX_ON_ARM=true
else ifeq ($(DEB_HOST_ARCH),arm64)
FLAGS += -march=armv8-a -mcpu=cortex-a53
CMAKE_EXTRA_OPTS = -DLINUX_ON_ARM=true
else
FLAGS += -mtune=generic -msse -msse2 -mfpmath=sse
endif

export CFLAGS=$(FLAGS)
export CXXFLAGS=$(FLAGS) -fvisibility-inlines-hidden -Wno-multichar -Wno-narrowing -Wno-write-strings
export CPPFLAGS=
export LDFLAGS=-Wl,-O1 -Wl,--as-needed -Wl,--no-undefined -Wl,--gc-sections -Wl,--strip-all
export PATH:=/opt/kxstudio/bin:$(PATH)
export PKG_CONFIG_PATH=/opt/kxstudio/lib/pkgconfig
export XDG_DATA_HOME=$(CURDIR)/debian/xdg-home

%:
	dh $@ -S cmake

override_dh_strip:
	dh_strip --no-automatic-dbgsym
	
override_dh_auto_configure:
	dh_auto_configure -- $(CMAKE_EXTRA_OPTS)

override_dh_usrlocal:

override_dh_auto_test:
	# nothing here

override_dh_dwz:
	dh_dwz --no-dwz-multifile
